# Centralized Audit Logging Service

Centralized Audit Logging Service is a multi-tenant, cloud-native solution for capturing, processing, and storing application logs in a structured and auditable way. The system is designed for Kubernetes environments, using Helm for deployment and leveraging Kafka for messaging.

## Features

* Multi-tenant log collection: Supports multiple tenants with row-level separation in the database.

* Flexible log ingestion: Logs can be generated by applications (Tenant Logger) or any microservice.

* Log forwarding and aggregation: Fluent Bit collects container logs and forwards them to Fluentd.

* Kafka messaging layer: Ensures decoupling and reliable delivery of logs.

* Python Processor: Consumes messages from Kafka, processes them, and inserts them into PostgreSQL.

* Kubernetes-native: Uses Kind, Helm, CronJobs, and StatefulSets.

* CI/CD ready: Docker images and Helm charts allow automated deployment.

## Components

1. Tenant Logger

   Simulates log generation for multiple tenants.

   Runs as a Kubernetes CronJob.

   Logs written to `/var/log/containers/*.log`.


2. Fluent Bit

    Collects container logs.

    Forwards logs to Fluentd via forward protocol.

    Runs as a DaemonSet in each node.


3. Fluentd

    Receives logs from Fluent Bit.

    Sends logs to Kafka topics (tenant-logs).

    Supports partitioning by tenant_id and buffering.

    Handles retries and buffering before Kafka ingestion.


4. Kafka

    Messaging layer to decouple log producers and consumers.

    Topics:

    I) tenant-logs (primary)
    II) tenant-logs-dlq (for failed messages)

    Supports multiple partitions for parallel processing.


5. Python Processor

    Consumes logs from Kafka.

    Processes and inserts them into PostgreSQL (tenant_logs table).

    Runs as a Deployment with FastAPI health endpoint.


6. PostgreSQL

    Multi-tenant log storage.

    Partitioned table per month for performance.

    Row-level security for tenant isolation.

    Can run as a StatefulSet in Kind.

    Migration jobs can be run via Helm Job.


## Prerequisites

* Kubernetes cluster (Kind or cloud provider)

* Helm 3+

* Docker registry for images


## Installation

1. Clone the repository:

    ```
    git clone https://github.com/priyankag048/centralized-audit-logging-service

    cd centralized-audit-logging-service
    ```

2.  Onboard fluentd, fluentbit, postgres, kafka
    Create kafka topics

    ```
      cd infrastructure/scripts
      chmod +x onboarding.sh
      ./onboarding.sh
    ```

3. Build Tenant Log Simulator and Tenant Log Processor:

    An utility script 

    ```
      cd infrastructure/scripts
      chmod +x build.sh
      ./build.sh
    ```

4. Deploy Tenant Log Simulator and Tenant Log Processor:

    An utility script 

    ```
      cd infrastructure/scripts
      chmod +x deploy.sh
      ./deploy.sh
    ```

## License

MIT License